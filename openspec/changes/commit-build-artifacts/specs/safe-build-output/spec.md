## ADDED Requirements

### Requirement: Manifest file tracks promptkit-managed files
Each builder SHALL write a manifest file in `.promptkit/managed/` (e.g., `claude.txt` for `.claude/`, `cursor.txt` for `.cursor/`) listing all generated file paths (relative to the output directory), one per line, sorted alphabetically, with a comment header.

#### Scenario: Manifest written after build
- **WHEN** a builder generates artifacts for 3 prompts in `.claude/`
- **THEN** a manifest file is created at `.promptkit/managed/claude.txt`
- **AND** it contains exactly 3 relative file paths, sorted alphabetically
- **AND** the first line is a comment: `# Generated by promptkit â€” do not edit`

#### Scenario: Manifest overwrites previous manifest
- **WHEN** a builder runs and the manifest file already exists in `.promptkit/managed/`
- **THEN** the manifest is overwritten with the current build's file list

### Requirement: Builder removes only previously managed files
Before writing new artifacts, each builder SHALL read the existing manifest from `.promptkit/managed/` and remove only the files listed in it from the output directory. Files not listed in the manifest SHALL NOT be touched.

#### Scenario: Stale managed files are removed
- **WHEN** the previous manifest lists `rules/old-rule.md`
- **AND** the new build does not generate `rules/old-rule.md`
- **THEN** `rules/old-rule.md` is deleted from the output directory

#### Scenario: Non-managed files are preserved
- **WHEN** the output directory contains `settings.json` (not in manifest)
- **AND** the builder runs
- **THEN** `settings.json` is still present after the build

#### Scenario: Non-managed files in category subdirectories are preserved
- **WHEN** the output directory contains `skills/openspec-apply/SKILL.md` (not in manifest)
- **AND** the builder generates `skills/my-skill.md`
- **THEN** both `skills/openspec-apply/SKILL.md` and `skills/my-skill.md` exist after build

### Requirement: Builder cleans empty directories after file removal
After removing previously managed files, the builder SHALL remove any category directories that are now empty. Directories that still contain files (managed or not) SHALL NOT be removed.

#### Scenario: Empty directory removed
- **WHEN** the only file in `agents/` was a managed file that was removed
- **AND** no new files are written to `agents/`
- **THEN** the `agents/` directory is removed

#### Scenario: Non-empty directory preserved
- **WHEN** `skills/` contains both a managed file (removed) and a non-managed file
- **THEN** the `skills/` directory is preserved

### Requirement: Missing manifest results in additive-only build
When the manifest file does not exist in `.promptkit/managed/`, the builder SHALL skip cleanup and only write new artifacts. No existing files SHALL be removed.

#### Scenario: First build on existing directory
- **WHEN** the output directory exists but has no manifest in `.promptkit/managed/`
- **AND** the output directory contains existing files
- **THEN** the builder writes new artifacts without removing any existing files
- **AND** a manifest file is created in `.promptkit/managed/`

#### Scenario: First build on empty directory
- **WHEN** the output directory does not exist
- **THEN** the builder creates the directory, writes artifacts, and creates the manifest in `.promptkit/managed/`
