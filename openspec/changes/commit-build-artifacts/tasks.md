## 1. Add manifest read/write/cleanup helpers

- [ ] 1.1 Create `source/promptkit/infra/builders/manifest.py` with `MANAGED_DIR = ".promptkit/managed"`, `MANIFEST_HEADER = "# Generated by promptkit — do not edit"`
- [ ] 1.2 Implement `read_manifest(fs, project_dir, platform_name) -> list[str]` — reads `.promptkit/managed/<platform_name>.txt`, returns list of relative paths (skipping comment lines), returns empty list if file doesn't exist
- [ ] 1.3 Implement `write_manifest(fs, project_dir, platform_name, paths: list[str])` — writes sorted relative paths with header comment to `.promptkit/managed/<platform_name>.txt`
- [ ] 1.4 Implement `cleanup_managed_files(fs, output_dir, manifest_paths: list[str])` — removes each listed file (resolved against output_dir) if it exists, then removes empty parent directories within output_dir
- [ ] 1.5 Write unit tests in `tests/infra/builders/test_manifest.py` covering: read existing manifest, read missing manifest, write manifest, cleanup removes files, cleanup preserves non-managed files, cleanup removes empty dirs, cleanup preserves non-empty dirs

## 2. Update ClaudeBuilder to use manifest-based cleanup

- [ ] 2.1 Replace `self._fs.remove_directory(output_dir)` in `ClaudeBuilder.build()` with: read manifest from `.promptkit/managed/claude.txt` → cleanup managed files → write new artifacts → write new manifest
- [ ] 2.2 Update `tests/infra/builders/test_claude_builder.py` — existing tests should pass with updated cleanup behavior
- [ ] 2.3 Add test: non-managed files (e.g., `settings.json`, `skills/openspec-apply/SKILL.md`) survive a rebuild
- [ ] 2.4 Add test: stale managed files from previous build are removed
- [ ] 2.5 Add test: first build without manifest is additive-only and creates manifest

## 3. Update CursorBuilder to use manifest-based cleanup

- [ ] 3.1 Replace `self._fs.remove_directory(output_dir)` in `CursorBuilder.build()` with: read manifest from `.promptkit/managed/cursor.txt` → cleanup managed files → write new artifacts → write new manifest
- [ ] 3.2 Update `tests/infra/builders/test_cursor_builder.py` — existing tests should pass with updated cleanup behavior
- [ ] 3.3 Add test: non-managed files survive a rebuild
- [ ] 3.4 Add test: stale managed files from previous build are removed
- [ ] 3.5 Add test: first build without manifest is additive-only and creates manifest

## 4. Update gitignore template in promptkit init

- [ ] 4.1 Update the `.gitignore` template in the init scaffolding to remove the commented-out `.cursor/` and `.claude/` lines (or add a comment recommending they be committed for team collaboration)

## 5. Verification

- [ ] 5.1 Run `pytest -x` — all existing tests pass
- [ ] 5.2 Run `pytest tests/infra/builders/ -v` — all builder tests pass including new manifest tests
- [ ] 5.3 Run `pyright` — no type errors
- [ ] 5.4 Run `ruff check .` — no lint issues
